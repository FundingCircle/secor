machine:
  services:
    - docker
  hosts:
    test-bucket.localhost: 127.0.0.1
    test-bucket: 127.0.0.1
  java:
    version: oraclejdk8
  environment:
    QUAY_EMAIL: engineering@fundingcircle.com

test:
  override:
    - ./conditional-build.sh

deployment:
  features:
    branch: /^(?!master$).*/ 
    commands:
      - docker login -u $QUAY_ROBOT_USERNAME -p $QUAY_ROBOT_PASSWORD  -e $QUAY_EMAIL quay.io
      - docker build -f Dockerfile -t quay.io/fundingcircle/secor:$CIRCLE_BRANCH .
      - docker push quay.io/fundingcircle/secor:$CIRCLE_BRANCH
  production:
    branch: master 
    commands:
      - docker login -u $QUAY_ROBOT_USERNAME -p $QUAY_ROBOT_PASSWORD  -e $QUAY_EMAIL quay.io
      - docker build -f Dockerfile.pinterest -t quay.io/fundingcircle/secor:dev .
      - docker push quay.io/fundingcircle/secor:dev
